
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Drive UICollectionView Interactive Layout Transition Using Facebook&#8217;s Pop - Something Awesome</title>
  <meta name="author" content="Nico Prananta">

  
  <meta name="description" content="Drive UICollectionView Interactive Layout Transition Using Facebook's Pop written in ios UICollectionView has a method to change layout easily: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  
  <link rel="canonical" href="http://www.nicnocquee.com/blog/2015/01/29/drive-uicollectionview-interactive-layout-transition-using-facebooks-pop">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Something Awesome" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,300italic,600italic' rel='stylesheet' type='text/css'>


<meta property="og:image" content="http://www.nicnocquee.com/images/background.jpg"/>

<meta property="og:title" content="Drive UICollectionView interactive layout transition using Facebook's Pop"/>
<meta property="og:url" content="http://www.nicnocquee.com/blog/2015/01/29/drive-uicollectionview-interactive-layout-transition-using-facebooks-pop"/>
<meta property="og:site_name" content="Something Awesome"/>
<meta property="og:type" content="blog"/>


</head>

  <body>
    <a href="/" class="home-icon">
      <img src="/images/home.png"/>
    </a>

    <article role="article" class="full-single-article">
  <div class="container">
    <div class="row">
        <h1 class="title">Drive UICollectionView Interactive Layout Transition Using Facebook&#8217;s Pop</h1>
        <div class="meta">
          written 








  



<time datetime="2015-01-29T11:30:53+09:00" pubdate data-updated="true"></time>
          

in
<span class="categories">
  
    <a class='category' href='/blog/categories/ios/'>ios</a>
  
</span>


        </div>
        <p>UICollectionView has a method to change layout easily: <code>setCollectionViewLayout:animated:completion:</code>. And according to documentation, if you implement the delegate&#8217;s <code>collectionView:transitionLayoutForOldLayout:newLayout:</code> you can customize the behaviour or the cells and decoration views during transition.</p>

<!-- more -->


<blockquote><p>Implement this method if you want to return a custom UICollectionViewTransitionLayout object for use during the transition. A transition layout object lets you customize the behavior of cells and decoration views when transitioning from one layout to the next. Normally, transitioning between layouts causes items to animate directly from their current locations to their new locations. With a transition layout object, you can have objects follow a non linear path, use a different timing algorithm, or move according to incoming touch events.</p>

<p>If your delegate does not implement this method, the collection view creates a standard UICollectionViewTransitionLayout object and uses that object to manage the transition.</p></blockquote>

<p>But strangely, that delegate&#8217;s method is not called when we change layout using <code>setCollectionViewLayout</code>. Somebody in <a href="http://stackoverflow.com/a/23009119/401544">stackoverflow</a> provided a workaround by calling collection view&#8217;s <code>startInteractiveTransitionToCollectionViewLayout:</code> method instead.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nl">startInteractiveTransitionToCollectionViewLayout</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">finalLayout</span> <span class="nl">completion</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="n">finishInteractiveTransition</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>The problem is we cannot control the speed of the animation. What I wanted is to &#8220;animate&#8221; the <code>UICollectionViewTransitionLayout</code>&#8217;s <code>transitionProgress</code> property like so.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">[</span><span class="bp">UIView</span> <span class="nl">animateWithDuration</span><span class="p">:</span><span class="mf">0.3</span> <span class="nl">delay</span><span class="p">:</span><span class="mi">0</span> <span class="nl">usingSpringWithDamping</span><span class="p">:</span><span class="mi">1</span> <span class="nl">initialSpringVelocity</span><span class="p">:</span><span class="mi">1</span> <span class="nl">options</span><span class="p">:</span><span class="n">UIViewAnimationOptionCurveEaseInOut</span> <span class="nl">animations</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">transition</span><span class="p">.</span><span class="n">transitionProgress</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span> <span class="nl">completion</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{}];</span>
</span></code></pre></td></tr></table></div></figure>


<p>But since transitionProgress is not animatable, this doesn&#8217;t work. This is where <a href="https://github.com/facebook/pop">Facebook&#8217;s Pop</a> comes to rescue. Using Pop, we can animate custom properties.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">// CustomTransitionLayout is subclass of UICollectionViewTransitionLayout</span>
</span><span class='line'><span class="n">CustomTransitionLayout</span> <span class="o">*</span><span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="n">CustomTransitionLayout</span> <span class="o">*</span><span class="p">)[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nl">startInteractiveTransitionToCollectionViewLayout</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">finalLayout</span> <span class="nl">completion</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</span><span class='line'>  
</span><span class='line'><span class="n">POPSpringAnimation</span> <span class="o">*</span><span class="n">springAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="n">POPSpringAnimation</span> <span class="n">animation</span><span class="p">];</span>
</span><span class='line'><span class="n">POPAnimatableProperty</span> <span class="o">*</span><span class="n">property</span> <span class="o">=</span> <span class="p">[</span><span class="n">POPAnimatableProperty</span> <span class="nl">propertyWithName</span><span class="p">:</span><span class="s">@&quot;com.photos.transition&quot;</span> <span class="nl">initializer</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">POPMutableAnimatableProperty</span> <span class="o">*</span><span class="n">prop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>   <span class="n">prop</span><span class="p">.</span><span class="n">readBlock</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">values</span><span class="p">[])</span> <span class="p">{</span>
</span><span class='line'>       <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="n">transitionProgress</span><span class="p">];</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'>   <span class="n">prop</span><span class="p">.</span><span class="n">writeBlock</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">values</span><span class="p">[])</span> <span class="p">{</span>
</span><span class='line'>       <span class="p">[</span><span class="n">obj</span> <span class="nl">setTransitionProgress</span><span class="p">:</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
</span><span class='line'>   <span class="p">};</span>
</span><span class='line'>   <span class="n">prop</span><span class="p">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">springBounciness</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</span><span class='line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">property</span> <span class="o">=</span> <span class="n">property</span><span class="p">;</span>
</span><span class='line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="l">@(</span><span class="n">progress</span><span class="l">)</span><span class="p">;</span>
</span><span class='line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="l">@(</span><span class="mf">1.0</span><span class="l">)</span><span class="p">;</span>
</span><span class='line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">completionBlock</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">POPAnimation</span> <span class="o">*</span><span class="n">anim</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">finished</span><span class="p">){</span>
</span><span class='line'>   <span class="k">if</span> <span class="p">(</span><span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>       <span class="p">[</span><span class="n">transition</span> <span class="nl">setTransitionProgress</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
</span><span class='line'>       <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="n">finishInteractiveTransition</span><span class="p">];</span>
</span><span class='line'>   <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'><span class="p">[</span><span class="n">transition</span> <span class="nl">pop_addAnimation</span><span class="p">:</span><span class="n">springAnimation</span> <span class="nl">forKey</span><span class="p">:</span><span class="n">NSStringFromSelector</span><span class="p">(</span><span class="k">@selector</span><span class="p">(</span><span class="n">transitionProgress</span><span class="p">))];</span>
</span></code></pre></td></tr></table></div></figure>


<p>This way, the value of <code>transitionProgress</code> will gradually change from 0 to 1. If you implement UICollectionViewTransitionLayout&#8217;s <code>layoutAttributesForElementsInRect:</code> method and set the attributes of each cell based on the value of <code>transitionProgress</code>, you can create a custom layout transition.</p>


        
        
        
    </div>
  </div>
</article>

<hr class="divider-short"/>

<div class="archive-link">
  <div class="container">
    <div class="row">
      <div class="col-md-8 col-md-offset-2">
        
          <a class="pull-left" href="/blog/2014/12/10/city-names-to-timezones-plist/" title="Previous Post: City names to timezones plist">&laquo; Previous: City names to timezones plist</a>
        

        
      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="her-row">
  <div class="container">
    <div class="row">
      <div class="col-md-1">
  <a href="/"><h4>Home</h4></a>
</div>

<div class="col-md-2">
  <div class="social-icon-list">
    
    <a href="https://twitter.com/nicnocquee"><img src="/images/glyphicons_social_31_twitter.png"/></a>
    

    
    <a href="https://github.com/nicnocquee"><img src="/images/glyphicons_social_21_github.png"/></a>
    

    

    
  </div>
</div>


      <div class="pull-right">
  <h4>Powered by <a href="http://octopress.org/">Octopress</a> using modified template by <a href="http://AdrianArtiles.com">Adrian Artiles</a>.</h4>
</div>

    </div>
  </div>
</footer>




<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<script src="/javascripts/open-in-blank.js" type="text/javascript"></script>
<script type='text/javascript'>var _merchantSettings=_merchantSettings || [];_merchantSettings.push(['AT', '11lMiE']);(function(){var autolink=document.createElement('script');autolink.type='text/javascript';autolink.async=true; autolink.src= ('https:' == document.location.protocol) ? 'https://autolinkmaker.itunes.apple.com/js/itunes_autolinkmaker.js' : 'http://autolinkmaker.itunes.apple.com/js/itunes_autolinkmaker.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(autolink, s);})();</script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34880613-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>




  </body>
</html>
