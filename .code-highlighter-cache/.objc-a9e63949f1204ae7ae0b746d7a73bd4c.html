<figure class='code-highlight-figure'><div class='code-highlight'><pre class='code-highlight-pre'><div data-line='1' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="c1">// CustomTransitionLayout is subclass of UICollectionViewTransitionLayout</span>
</div></div><div data-line='2' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">CustomTransitionLayout</span> <span class="o">*</span><span class="n">transition</span> <span class="o">=</span> <span class="p">(</span><span class="n">CustomTransitionLayout</span> <span class="o">*</span><span class="p">)[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="nl">startInteractiveTransitionToCollectionViewLayout</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">finalLayout</span> <span class="nl">completion</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
</div></div><div data-line='3' class='code-highlight-row numbered'><div class='code-highlight-line'> </div></div><div data-line='4' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">POPSpringAnimation</span> <span class="o">*</span><span class="n">springAnimation</span> <span class="o">=</span> <span class="p">[</span><span class="n">POPSpringAnimation</span> <span class="n">animation</span><span class="p">];</span>
</div></div><div data-line='5' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">POPAnimatableProperty</span> <span class="o">*</span><span class="n">property</span> <span class="o">=</span> <span class="p">[</span><span class="n">POPAnimatableProperty</span> <span class="nl">propertyWithName</span><span class="p">:</span><span class="s">@&quot;com.photos.transition&quot;</span> <span class="nl">initializer</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">POPMutableAnimatableProperty</span> <span class="o">*</span><span class="n">prop</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line='6' class='code-highlight-row numbered'><div class='code-highlight-line'>   <span class="n">prop</span><span class="p">.</span><span class="n">readBlock</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="n">CGFloat</span> <span class="n">values</span><span class="p">[])</span> <span class="p">&#x7b;</span>
</div></div><div data-line='7' class='code-highlight-row numbered'><div class='code-highlight-line'>       <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="n">transitionProgress</span><span class="p">];</span>
</div></div><div data-line='8' class='code-highlight-row numbered'><div class='code-highlight-line'>   <span class="p">&#x7d;;</span>
</div></div><div data-line='9' class='code-highlight-row numbered'><div class='code-highlight-line'>   <span class="n">prop</span><span class="p">.</span><span class="n">writeBlock</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="kt">id</span> <span class="n">obj</span><span class="p">,</span> <span class="k">const</span> <span class="n">CGFloat</span> <span class="n">values</span><span class="p">[])</span> <span class="p">&#x7b;</span>
</div></div><div data-line='10' class='code-highlight-row numbered'><div class='code-highlight-line'>       <span class="p">[</span><span class="n">obj</span> <span class="nl">setTransitionProgress</span><span class="p">:</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
</div></div><div data-line='11' class='code-highlight-row numbered'><div class='code-highlight-line'>   <span class="p">&#x7d;;</span>
</div></div><div data-line='12' class='code-highlight-row numbered'><div class='code-highlight-line'>   <span class="n">prop</span><span class="p">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>
</div></div><div data-line='13' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">&#x7d;];</span>
</div></div><div data-line='14' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">springBounciness</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
</div></div><div data-line='15' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">property</span> <span class="o">=</span> <span class="n">property</span><span class="p">;</span>
</div></div><div data-line='16' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">fromValue</span> <span class="o">=</span> <span class="l">@(</span><span class="n">progress</span><span class="l">)</span><span class="p">;</span>
</div></div><div data-line='17' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">toValue</span> <span class="o">=</span> <span class="l">@(</span><span class="mf">1.0</span><span class="l">)</span><span class="p">;</span>
</div></div><div data-line='18' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="n">springAnimation</span><span class="p">.</span><span class="n">completionBlock</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">POPAnimation</span> <span class="o">*</span><span class="n">anim</span><span class="p">,</span> <span class="kt">BOOL</span> <span class="n">finished</span><span class="p">)&#x7b;</span>
</div></div><div data-line='19' class='code-highlight-row numbered'><div class='code-highlight-line'>   <span class="k">if</span> <span class="p">(</span><span class="n">finished</span><span class="p">)</span> <span class="p">&#x7b;</span>
</div></div><div data-line='20' class='code-highlight-row numbered'><div class='code-highlight-line'>       <span class="p">[</span><span class="n">transition</span> <span class="nl">setTransitionProgress</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
</div></div><div data-line='21' class='code-highlight-row numbered'><div class='code-highlight-line'>       <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">collectionView</span> <span class="n">finishInteractiveTransition</span><span class="p">];</span>
</div></div><div data-line='22' class='code-highlight-row numbered'><div class='code-highlight-line'>   <span class="p">&#x7d;</span>
</div></div><div data-line='23' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">&#x7d;;</span>
</div></div><div data-line='24' class='code-highlight-row numbered'><div class='code-highlight-line'><span class="p">[</span><span class="n">transition</span> <span class="nl">pop_addAnimation</span><span class="p">:</span><span class="n">springAnimation</span> <span class="nl">forKey</span><span class="p">:</span><span class="n">NSStringFromSelector</span><span class="p">(</span><span class="k">@selector</span><span class="p">(</span><span class="n">transitionProgress</span><span class="p">))];</span></div></div></pre></div></figure>